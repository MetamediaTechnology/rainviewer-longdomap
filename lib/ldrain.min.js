function RainRadar(b,a){var d=this;function c(){try{let a=new XMLHttpRequest;a.open("GET","https://api.rainviewer.com/public/weather-maps.json",!0),a.onload=function(b){d.apiData=JSON.parse(a.response),e()},a.send()}catch(b){d.apiData=[]}}function e(){if(d.mapFrames=[],b.Layers.list(),!d.apiData)throw new Error("Can't get data");d.apiData.radar&&d.apiData.radar.past&&(d.mapFrames=d.apiData.radar.past,d.apiData.radar.nowcast&&(d.mapFrames=d.mapFrames.concat(d.apiData.radar.nowcast)),d.lastPastFramePosition=d.apiData.radar.past.length-1,d.animationPosition=d.lastPastFramePosition,g(d.lastPastFramePosition))}function f(){return b.Layers.list().map(a=>a.name()).indexOf(d.layerkey)}function g(a){d.animationPosition==d.mapFrames.length&&(d.animationPosition=0,a=d.animationPosition),d.animationPosition<0&&(d.animationPosition=d.mapFrames.length-1,a=d.animationPosition),h(d.mapFrames[a])}function h(a){if(a||(a=d.mapFrames[d.animationPosition]),d.display){var c=f();d.currentLayer&& -1!==c?-1!==c&&(b.Layers.list()[c]=new longdo.Layer(d.layerkey,{type:longdo.LayerType.Custom,opacity:d.opacity,url:function(e,b,c,f){return"https://tilecache.rainviewer.com"+a.path+"/"+d.tileSize+"/"+c+"/"+b.u+"/"+b.v+"/"+d.radarColor+"/1_1.png"}})):(d.currentLayer=new longdo.Layer(d.layerkey,{type:longdo.LayerType.Custom,opacity:d.opacity,url:function(e,b,c,f){return"https://tilecache.rainviewer.com"+a.path+"/"+d.tileSize+"/"+c+"/"+b.u+"/"+b.v+"/"+d.radarColor+"/1_1.png"}}),b.Layers.add(d.currentLayer)),d.displayRadarTime(a.time)}}function i(f){let a=null,g=d.mapFrames[d.animationPosition];switch(f){case"NEXT":a=d.mapFrames[d.animationPosition+1];break;case"PREVIOS":a=d.mapFrames[d.animationPosition-1];break;case"START":a=d.mapFrames[0];break;case"END":a=d.mapFrames[d.mapFrames.length-1]}d.displayRadarTime(a.time);let h=URL,c=document.getElementsByClassName("ldmap_maparea");for(let b=0;b<c.length;b++){let e=c[b].src;if(e){let{hostname:i}=new h(e);if("tilecache.rainviewer.com"===i){let j=e.replace(g.path,`/${a.path}`);c[b].src=j}}}}this.map=null,this.apiData=null,this.display=!0,this.timeDisplay=a.timeDisplay||null,this.optionKind="radar",this.tileSize=a.tileSize||256,this.animation=!1,this.radarColor=a.color||2,this.opacity=a.opacity||.7,this.isReload=a.automation||!1,this.reloadTime=6e4,this.getDataInterval=!1,this.mapFrames=[],this.lastPastFramePosition=0,this.currentLayer=null,this.layerkey="rainRadarLayers",this.isAnimation=!1,this.animationInterval=null,this.animationPosition=0,this.animationSpeed=2e3,c(),b.Event.bind("drop",()=>{h()}),b.Event.bind("zoom",()=>{h()}),this.fourceReload=()=>{c()},this.setColor=a=>{d.radarColor=a},this.setOpacity=a=>{d.opacity=a},this.reload=a=>{a&&(d.reloadTime=Number.parseInt(a)||6e4),d.isReload?(d.isReload=!1,clearInterval(d.getDataInterval)):(d.isReload=!0,d.getDataInterval=setInterval(()=>{c()},d.reloadTime))},this.clearLayers=(a=!1)=>{if(a){let c=b.Layers.list()[f()];b.Layers.remove(c)}return d.display=a,clearInterval(d.animationInterval),!0},this.playAnimation=a=>(a&&(d.animationSpeed=Number.parseInt(a)||1e3),d.isAnimation?(clearInterval(d.animationInterval),d.isAnimation=!1):(d.isAnimation=!0,d.animationInterval=setInterval(()=>{d.next()},d.animationSpeed)),d.isAnimation),this.displayRadarTime=a=>{null!==d.timeDisplay&&(document.getElementById(d.timeDisplay).innerHTML=new Date(1e3*a).toLocaleDateString("th-Th",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}))},this.radarNow=()=>{c()},this.next=()=>{d.animationPosition==d.mapFrames.length-1?(i("START"),d.animationPosition=0):(i("NEXT"),d.animationPosition+=1)},this.previos=()=>{0>= !d.animationPosition?(i("PREVIOS"),d.animationPosition-=1):(i("END"),d.animationPosition=d.mapFrames.length-1)}}
